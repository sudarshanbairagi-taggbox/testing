{"version":3,"sources":["ProviderView.js"],"names":["h","require","AuthView","Header","Browser","LoaderView","CloseWrapper","View","getOrigin","location","origin","module","exports","ProviderView","constructor","plugin","opts","defaultOptions","viewType","showTitles","showFilter","showBreadcrumbs","filterQuery","bind","getFolder","getNextFolder","logout","handleAuth","handleScroll","listAllFiles","donePicking","render","setPluginState","authenticated","files","folders","directories","filterInput","isSearchVisible","currentSelection","tearDown","id","name","sharedHandler","loaderWrapper","provider","list","res","updatedDirectories","state","getPluginState","index","findIndex","dir","slice","concat","title","username","handleError","folder","requestPath","lastCheckbox","undefined","then","ok","revoked","message","uppy","i18n","url","manual_revoke_url","info","newState","catch","e","target","value","addFolder","folderId","providerFileToId","selectedFolders","loading","count","forEach","file","checkIfFileAlreadyExists","addFile","ids","map","length","smart_count","ensurePreAuth","authState","btoa","JSON","stringify","clientVersion","VERSION","link","authUrl","uppyVersions","authWindow","window","open","handleToken","companionAllowedHosts","source","log","data","parse","error","token","close","removeEventListener","setAuthToken","preFirstRender","addEventListener","event","path","nextPagePath","shouldHandleScroll","isHandlingScroll","response","Promise","resolve","reject","items","item","isFolder","push","moreFiles","promises","all","clearSelection","viewOptions","didFirstRender","targetViewOptions","isChecked","toggleCheckbox","filterItems","hasInput","headerProps","pluginIcon","icon","browserProps","done","cancel","cancelPicking","headerComponent","uppyFiles","getFiles","validateRestrictions","i18nArray","allowedOrigin","getRegex","RegExp","patterns","Array","isArray","filter","pattern","some","test"],"mappings":"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","sourcesContent":["const { h } = require('preact')\nconst AuthView = require('./AuthView')\nconst Header = require('./Header')\nconst Browser = require('../Browser')\nconst LoaderView = require('../Loader')\nconst CloseWrapper = require('../CloseWrapper')\nconst View = require('../View')\n\nfunction getOrigin () {\n  // eslint-disable-next-line no-restricted-globals\n  return location.origin\n}\n\n/**\n * Class to easily generate generic views for Provider plugins\n */\nmodule.exports = class ProviderView extends View {\n  static VERSION = require('../../package.json').version\n\n  /**\n   * @param {object} plugin instance of the plugin\n   * @param {object} opts\n   */\n  constructor (plugin, opts) {\n    super(plugin, opts)\n    // set default options\n    const defaultOptions = {\n      viewType: 'list',\n      showTitles: true,\n      showFilter: true,\n      showBreadcrumbs: true,\n    }\n\n    // merge default options with the ones set by user\n    this.opts = { ...defaultOptions, ...opts }\n\n    // Logic\n    this.filterQuery = this.filterQuery.bind(this)\n    this.getFolder = this.getFolder.bind(this)\n    this.getNextFolder = this.getNextFolder.bind(this)\n    this.logout = this.logout.bind(this)\n    this.handleAuth = this.handleAuth.bind(this)\n    this.handleScroll = this.handleScroll.bind(this)\n    this.listAllFiles = this.listAllFiles.bind(this)\n    this.donePicking = this.donePicking.bind(this)\n\n    // Visual\n    this.render = this.render.bind(this)\n\n    // Set default state for the plugin\n    this.plugin.setPluginState({\n      authenticated: false,\n      files: [],\n      folders: [],\n      directories: [],\n      filterInput: '',\n      isSearchVisible: false,\n      currentSelection: [],\n    })\n  }\n\n  tearDown () {\n    // Nothing.\n  }\n\n  #updateFilesAndFolders (res, files, folders) {\n    this.nextPagePath = res.nextPagePath\n    res.items.forEach((item) => {\n      if (item.isFolder) {\n        folders.push(item)\n      } else {\n        files.push(item)\n      }\n    })\n\n    this.plugin.setPluginState({ folders, files })\n  }\n\n  /**\n   * Based on folder ID, fetch a new folder and update it to state\n   *\n   * @param  {string} id Folder id\n   * @returns {Promise}   Folders/files in folder\n   */\n  getFolder (id, name) {\n    return this.sharedHandler.loaderWrapper(\n      this.provider.list(id),\n      (res) => {\n        const folders = []\n        const files = []\n        let updatedDirectories\n\n        const state = this.plugin.getPluginState()\n        const index = state.directories.findIndex((dir) => id === dir.id)\n\n        if (index !== -1) {\n          updatedDirectories = state.directories.slice(0, index + 1)\n        } else {\n          updatedDirectories = state.directories.concat([{ id, title: name }])\n        }\n\n        this.username = res.username || this.username\n        this.#updateFilesAndFolders(res, files, folders)\n        this.plugin.setPluginState({ directories: updatedDirectories })\n      },\n      this.handleError,\n    )\n  }\n\n  /**\n   * Fetches new folder\n   *\n   * @param  {object} folder\n   */\n  getNextFolder (folder) {\n    this.getFolder(folder.requestPath, folder.name)\n    this.lastCheckbox = undefined\n  }\n\n  /**\n   * Removes session token on client side.\n   */\n  logout () {\n    this.provider.logout()\n      .then((res) => {\n        if (res.ok) {\n          if (!res.revoked) {\n            const message = this.plugin.uppy.i18n('companionUnauthorizeHint', {\n              provider: this.plugin.title,\n              url: res.manual_revoke_url,\n            })\n            this.plugin.uppy.info(message, 'info', 7000)\n          }\n\n          const newState = {\n            authenticated: false,\n            files: [],\n            folders: [],\n            directories: [],\n          }\n          this.plugin.setPluginState(newState)\n        }\n      }).catch(this.handleError)\n  }\n\n  filterQuery (e) {\n    const state = this.plugin.getPluginState()\n    this.plugin.setPluginState({ ...state, filterInput: e ? e.target.value : '' })\n  }\n\n  /**\n   * Adds all files found inside of specified folder.\n   *\n   * Uses separated state while folder contents are being fetched and\n   * mantains list of selected folders, which are separated from files.\n   */\n  addFolder (folder) {\n    const folderId = this.providerFileToId(folder)\n    const state = this.plugin.getPluginState()\n    const folders = { ...state.selectedFolders }\n\n    if (folderId in folders && folders[folderId].loading) {\n      return\n    }\n\n    folders[folderId] = { loading: true, files: [] }\n\n    this.plugin.setPluginState({ selectedFolders: { ...folders } })\n\n    // eslint-disable-next-line consistent-return\n    return this.listAllFiles(folder.requestPath).then((files) => {\n      let count = 0\n\n      // If the same folder is added again, we don't want to send\n      // X amount of duplicate file notifications, we want to say\n      // the folder was already added. This checks if all files are duplicate,\n      // if that's the case, we don't add the files.\n      files.forEach(file => {\n        const id = this.providerFileToId(file)\n        if (!this.plugin.uppy.checkIfFileAlreadyExists(id)) {\n          count++\n        }\n      })\n\n      if (count > 0) {\n        files.forEach((file) => this.addFile(file))\n      }\n\n      const ids = files.map(this.providerFileToId)\n\n      folders[folderId] = {\n        loading: false,\n        files: ids,\n      }\n      this.plugin.setPluginState({ selectedFolders: folders })\n\n      let message\n\n      if (count === 0) {\n        message = this.plugin.uppy.i18n('folderAlreadyAdded', {\n          folder: folder.name,\n        })\n      } else if (files.length) {\n        message = this.plugin.uppy.i18n('folderAdded', {\n          smart_count: count, folder: folder.name,\n        })\n      } else {\n        message = this.plugin.uppy.i18n('emptyFolderAdded')\n      }\n\n      this.plugin.uppy.info(message)\n    }).catch((e) => {\n      const state = this.plugin.getPluginState()\n      const selectedFolders = { ...state.selectedFolders }\n      delete selectedFolders[folderId]\n      this.plugin.setPluginState({ selectedFolders })\n      this.handleError(e)\n    })\n  }\n\n  async handleAuth () {\n    await this.provider.ensurePreAuth()\n\n    const authState = btoa(JSON.stringify({ origin: getOrigin() }))\n    const clientVersion = `@uppy/provider-views=${ProviderView.VERSION}`\n    const link = this.provider.authUrl({ state: authState, uppyVersions: clientVersion })\n\n    const authWindow = window.open(link, '_blank')\n    const handleToken = (e) => {\n      if (!this.#isOriginAllowed(e.origin, this.plugin.opts.companionAllowedHosts) || e.source !== authWindow) {\n        this.plugin.uppy.log(`rejecting event from ${e.origin} vs allowed pattern ${this.plugin.opts.companionAllowedHosts}`)\n        return\n      }\n\n      // Check if it's a string before doing the JSON.parse to maintain support\n      // for older Companion versions that used object references\n      const data = typeof e.data === 'string' ? JSON.parse(e.data) : e.data\n\n      if (data.error) {\n        this.plugin.uppy.log('auth aborted')\n        const { uppy } = this.plugin\n        const message = uppy.i18n('authAborted')\n        uppy.info({ message }, 'warning', 5000)\n        return\n      }\n\n      if (!data.token) {\n        this.plugin.uppy.log('did not receive token from auth window')\n        return\n      }\n\n      authWindow.close()\n      window.removeEventListener('message', handleToken)\n      this.provider.setAuthToken(data.token)\n      this.preFirstRender()\n    }\n    window.addEventListener('message', handleToken)\n  }\n\n  #isOriginAllowed (origin, allowedOrigin) {\n    const getRegex = (value) => {\n      if (typeof value === 'string') {\n        return new RegExp(`^${value}$`)\n      } if (value instanceof RegExp) {\n        return value\n      }\n    }\n\n    const patterns = Array.isArray(allowedOrigin) ? allowedOrigin.map(getRegex) : [getRegex(allowedOrigin)]\n    return patterns\n      .filter((pattern) => pattern != null) // loose comparison to catch undefined\n      .some((pattern) => pattern.test(origin) || pattern.test(`${origin}/`)) // allowing for trailing '/'\n  }\n\n  async handleScroll (event) {\n    const path = this.nextPagePath || null\n\n    if (this.shouldHandleScroll(event) && path) {\n      this.isHandlingScroll = true\n\n      try {\n        const response = await this.provider.list(path)\n        const { files, folders } = this.plugin.getPluginState()\n\n        this.#updateFilesAndFolders(response, files, folders)\n      } catch (error) {\n        this.handleError(error)\n      } finally {\n        this.isHandlingScroll = false\n      }\n    }\n  }\n\n  listAllFiles (path, files = null) {\n    files = files || []\n    return new Promise((resolve, reject) => {\n      this.provider.list(path).then((res) => {\n        res.items.forEach((item) => {\n          if (!item.isFolder) {\n            files.push(item)\n          } else {\n            this.addFolder(item)\n          }\n        })\n        const moreFiles = res.nextPagePath || null\n        if (moreFiles) {\n          return this.listAllFiles(moreFiles, files)\n            .then((files) => resolve(files))\n            .catch(e => reject(e))\n        }\n        return resolve(files)\n      }).catch(e => reject(e))\n    })\n  }\n\n  donePicking () {\n    const { currentSelection } = this.plugin.getPluginState()\n    const promises = currentSelection.map((file) => {\n      if (file.isFolder) {\n        return this.addFolder(file)\n      }\n      return this.addFile(file)\n    })\n\n    this.sharedHandler.loaderWrapper(Promise.all(promises), () => {\n      this.clearSelection()\n    }, () => {})\n  }\n\n  render (state, viewOptions = {}) {\n    const { authenticated, didFirstRender } = this.plugin.getPluginState()\n\n    if (!didFirstRender) {\n      this.preFirstRender()\n    }\n\n    const targetViewOptions = { ...this.opts, ...viewOptions }\n    const { files, folders, filterInput, loading, currentSelection } = this.plugin.getPluginState()\n    const { isChecked, toggleCheckbox, filterItems } = this.sharedHandler\n    const hasInput = filterInput !== ''\n    const headerProps = {\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      getFolder: this.getFolder,\n      directories: this.plugin.getPluginState().directories,\n      pluginIcon: this.plugin.icon,\n      title: this.plugin.title,\n      logout: this.logout,\n      username: this.username,\n      i18n: this.plugin.uppy.i18n,\n    }\n\n    const browserProps = {\n      isChecked,\n      toggleCheckbox,\n      currentSelection,\n      files: hasInput ? filterItems(files) : files,\n      folders: hasInput ? filterItems(folders) : folders,\n      username: this.username,\n      getNextFolder: this.getNextFolder,\n      getFolder: this.getFolder,\n      filterItems: this.sharedHandler.filterItems,\n      filterQuery: this.filterQuery,\n      logout: this.logout,\n      handleScroll: this.handleScroll,\n      listAllFiles: this.listAllFiles,\n      done: this.donePicking,\n      cancel: this.cancelPicking,\n      headerComponent: Header(headerProps),\n      title: this.plugin.title,\n      viewType: targetViewOptions.viewType,\n      showTitles: targetViewOptions.showTitles,\n      showFilter: targetViewOptions.showFilter,\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      pluginIcon: this.plugin.icon,\n      i18n: this.plugin.uppy.i18n,\n      uppyFiles: this.plugin.uppy.getFiles(),\n      validateRestrictions: (...args) => this.plugin.uppy.validateRestrictions(...args),\n    }\n\n    if (loading) {\n      return (\n        <CloseWrapper onUnmount={this.clearSelection}>\n          <LoaderView i18n={this.plugin.uppy.i18n} />\n        </CloseWrapper>\n      )\n    }\n\n    if (!authenticated) {\n      return (\n        <CloseWrapper onUnmount={this.clearSelection}>\n          <AuthView\n            pluginName={this.plugin.title}\n            pluginIcon={this.plugin.icon}\n            handleAuth={this.handleAuth}\n            i18n={this.plugin.uppy.i18n}\n            i18nArray={this.plugin.uppy.i18nArray}\n          />\n        </CloseWrapper>\n      )\n    }\n\n    return (\n      <CloseWrapper onUnmount={this.clearSelection}>\n        <Browser {...browserProps} />\n      </CloseWrapper>\n    )\n  }\n}\n"]}